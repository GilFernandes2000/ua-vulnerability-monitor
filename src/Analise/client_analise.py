import socket 
import json
import struct
import pickle

SIZE = 1024
FORMAT = 'utf-8'

class Client():
    
    def send_data(self, conn, data):
        serialized_data = pickle.dumps(data)
        conn.sendall(struct.pack('>I', len(serialized_data)))
        conn.sendall(serialized_data)

    def client_send(self, filename, IP='127.0.0.1', PORT=1234):
        ADDR = (str(IP), int(PORT))
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as client:
            print('Client Starting...')
            client.connect(ADDR)
            
            # client.sendall(b'domains.json')
            client.send(f'{filename}'.encode(FORMAT))
            msg = client.recv(SIZE).decode(FORMAT)
            print(f'[SERVER]: {msg}')
            
            with open(filename, 'r') as file:
                data = json.loads(file.read())
                self.send_data(client, data)
                msg = client.recv(SIZE).decode(FORMAT)
                print(f'[SERVER]: {msg}')