import markdown
import json
from xhtml2pdf import pisa

def html_2_pdf(in_html):
    res_file = open('report.pdf', 'w+b')
    pisa_stats = pisa.CreatePDF(in_html, dest=res_file)
    res_file.close()
    
    return pisa_stats.err

with open('../Analise/final_cvss_scores.json','r') as j:
    ips = json.loads(j.read())

with open('../Analise/ips.json', 'r') as i:
    domains = json.loads(i.read())

with open('relatorio.md', 'bw+') as f:
    for ip in ips:
        name = list(domains.keys())[list(domains.values()).index(ip)]
        f.write('<h1>{} - {}</h1>'.format(ip,name).encode('utf-8'))
        for cve in ips[ip]:
            f.write('<h2>{}</h2>\n'.format(cve).encode('utf-8'))
            for info, thing in ips[ip][cve].items():
                f.write('<b>{}</b>: {}</br>'.format(info, thing).encode('utf-8'))
                
                # for thing in ips[ip][cve][str(info)]:
                #     f.write('#### {}\n'.format(thing).encode('utf-8'))
        f.write('\n'.encode('utf-8'))
    f.seek(0)
    
    markdown.markdownFromFile(input=f, output='report.html')

in_html = open('report.html', 'r')
pisa.showLogging()
html_2_pdf(in_html)
in_html.close()
