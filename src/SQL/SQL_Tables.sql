create database IP_CVE_Bank;
DROP DATABASE IP_CVE_Bank

/* 
 drop table Project.Machine_Vuln;
 drop table Project.Machine;
 drop table Project.CVE;
 drop table Project.Department; */
-- drop schema Project;

USE IP_CVE_Bank;
GO

CREATE SCHEMA Project;
GO


CREATE TABLE Project.Machine(
	IP_address		VARCHAR(16) NOT NULL,
	Machine_User	VARCHAR(80),
	Machine_Owner	VARCHAR(80) NOT NULL,
	Software		VARCHAR(80) NOT NULL,
	Software_ver	VARCHAR(10) NOT NULL,
	FK_Department	int			NOT NULL,
	
	PRIMARY KEY(IP_address),
	FOREIGN KEY(FK_Department) REFERENCES Project.Department(id)
);

CREATE TABLE Project.CVE(
	CVE_id		VARCHAR(30)		NOT NULL,
	CVSS		VARCHAR(5)		NOT NULL,
	descript	VARCHAR(200), 

	PRIMARY KEY(CVE_id)
);

CREATE TABLE Project.Machine_Vuln(
	FK_Machine		int				NOT NULL,
	FK_CVE			VARCHAR(30)		NOT NULL,

	PRIMARY KEY(FK_Machine,FK_CVE),

	FOREIGN KEY(FK_Machine) REFERENCES Project.Machine(id),
	FOREIGN KEY(FK_CVE) REFERENCES Project.CVE(CVE_id)
);

CREATE TABLE Project.Users(
	username	VARCHAR(40)	 NOT NULL,
	email		VARCHAR(40)	 NOT NULL,
	role_		VARCHAR(10)	 NOT NULL,
	name_		VARCHAR(100) NOT NULL,

	PRIMARY KEY(username)
);

CREATE TABLE Project.UserMachine(
	FK_IP		int,
	FK_Users	VARCHAR(40)	 NOT NULL,

	PRIMARY KEY(FK_IP,FK_Users),

	FOREIGN KEY(FK_IP) REFERENCES Project.IP(id),
	FOREIGN KEY(FK_Users) REFERENCES Project.Users(username)
);
