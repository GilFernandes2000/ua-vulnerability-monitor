from celery import Celery
import os
from django.conf import settings
from celery.schedules import crontab


# Create default Celery app
app = Celery(broker='amqp://guest@rabbitmq//')

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'uavm.settings')

# namespace='CELERY' means all celery-related configuration keys
app.config_from_object("django.conf:settings", namespace="CELERY")

# Using a string here means the worker will not have to
# pickle the object when using Windows.
app.config_from_object('django.conf:settings')
app.autodiscover_tasks()

app.conf.beat_schedule = {
      'analise-run-sunday-3am': {
        'task': 'tasks.analiseAll',
        'schedule': 30.0,
        'args': ('ua.pt')
    },
}
app.conf.beat_schedule = {
      'analise-run-sunday-3am': {
        'task': 'tasks.analiseAll',
        'schedule': crontab(hour=3, minute=0, day_of_week='sunday'),
        'args': ('it.pt')
    },
}
app.conf.timezone = 'UTC'  

# When we use the following in Django, it loads all the <appname>.tasks
# files and registers any tasks it finds in them. We can import the
# tasks files some other way if we prefer.
app.autodiscover_tasks()