# import necessary packages
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from read_contacts import *
from read_template import *
from variables import *
#import the smtplib module. It should be included in Python by default
import smtplib

#setup the SMTP server
with smtplib.SMTP('smtp.gmail.com', 587) as smtp:
    smtp.ehlo()
    smtp.starttls()
    smtp.ehlo()

    smtp.login(MY_ADDRESS, PASSWORD)

    names, emails = get_contacts('mycontacts.txt')  # read contacts
    message_template = read_template('message.txt')

    # for each contact, send the email:
    for name, email in zip(names, emails):
        msg = MIMEMultipart()       #create message

        #add in the actual person name to the person template
        message = message_template.substitute(PERSON_NAME = name.title())

        #setup the parameters of the message
        msg['FROM'] = MY_ADDRESS
        msg['To'] = email
        msg['Subject'] = "This is a TEST"

        #add in the message body
        msg.attach(MIMEText(message, 'plain'))

        #send the message via the server set up earlier
        smtp.send_message(msg)

        print("msg sent")
        del msg
