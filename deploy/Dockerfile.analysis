FROM kalilinux/kali-rolling as initial_setup

WORKDIR /root

# instalações necessarias
RUN apt -y update --fix-missing && apt -y upgrade && apt -y autoremove && apt clean
RUN apt-get -y install python3 python3-distutils python3-pip python3-apt
RUN apt -y install nmap && apt -y install git
RUN apt-get install -y \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

# vulscan
RUN git clone https://github.com/scipag/vulscan.git ./vulscan

# dnsDumpster
# RUN git clone https://github.com/PaulSec/API-dnsdumpster.com ./dnsdumpster

FROM initial_setup 

# ficheiro com todos os cves
ADD https://cve.mitre.org/data/downloads/allitems.csv ./vulscan

# vulscan no nmap
RUN mv ./vulscan ../usr/share/nmap/scripts

# instalação dos requirements
COPY requirements.txt .
RUN pip3 install -r requirements.txt
#RUN pip3 install https://github.com/PaulSec/API-dnsdumpster.com/archive/master.zip --user

COPY . .

RUN chmod +x run.sh

ENTRYPOINT ["python3", "runAll.py"]